<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 image_list_section p-3 border-end">
      <div class="d-flex align-items-center mb-3">
        <h5 class="mb-0">List of Images</h5>
        <button class="btn btn-sm btn-outline-secondary ms-auto" (click)="refreshList()">Refresh</button>
      </div>

      <div *ngIf="imagesList?.length === 0" class="text-muted small mb-2">No images uploaded yet.</div>

      <div class="list-group overflow-auto" style="max-height:70vh;">
        <a *ngFor="let image of imagesList"
           class="list-group-item list-group-item-action d-flex align-items-center image_list_item"
           [class.active]="selectedImage === image"
           (click)="selectImage(image)">
          <img [src]="getImageUrl(image)" alt="thumb" class="thumb me-2" />
          <div class="fname text-truncate">{{ image }}</div>
          <button class="btn btn-sm btn-danger ms-2" (click)="deleteImage(image); $event.stopPropagation()"><i class="fa-solid fa-trash"></i></button>
        </a>
      </div>

      <hr />

      <div class="mt-3">
        <label class="btn btn-primary w-100">
          Select file to upload
          <input type="file" (change)="onFileSelected($event)" hidden />
        </label>

        <div *ngIf="uploading" class="mt-2">
          <div class="progress">
            <div class="progress-bar progress-bar-striped" role="progressbar"
                 [style.width.%]="uploadProgress">{{ uploadProgress }}%</div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-9 p-4">
      <div *ngIf="!selectedImage" class="text-center text-muted">
        <p>Select an image to view and analyse.</p>
      </div>

      <div *ngIf="selectedImage">
        <div class="d-flex align-items-start mb-3">
          <div class="image_box">
            <img [src]="getImageUrl(selectedImage)" alt="preview" class="preview-img" />
          </div>
          <div class="ms-3 flex-grow-1">
            <h5 class="mb-1">{{ selectedImage }}</h5>
            <div class="mb-2">
              <button class="btn btn-info" (click)="doWordAnalyse()">Analyse Image</button>
            </div>
          </div>
        </div>

        <div *ngIf="results && results.length">
          <h6>Results</h6>
          <table class="table table-sm table-bordered">
            <thead><tr><th>Region Text</th><th>Model's Confidence (Scale: 0-1)</th></tr></thead>
            <tbody>
              <tr *ngFor="let r of results[0].regions">
                <td>{{ r.region_text }}</td>
                <td>{{ r.region_confidence | number:'1.2-4' }}</td>
              </tr>
            </tbody>
            <ul class="small text-muted mt-1">
                <li>Confidence: Confidence is the model’s internal reported probability (a prediction-level value).</li>
                <li>Accuracy: Accuracy is an empirical metric computed on labeled ground-truth data: e.g. 
                    fraction of words (or characters) that the model predicted exactly correct.</li>
            </ul>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- processing loader -->
 <div *ngIf="processing" class="processing-overlay">
  <div class="processing-content text-center">
    <div class="spinner-border" role="status" aria-hidden="true"></div>
    <div class="mt-3 fw-semibold">Image is being processed — please wait...</div>
    <div class="small mt-1">This may take a few seconds.</div>
  </div>
</div>
